<template>
  <div class="confirmation-request">
    <div class="confirmation-header">
      <span class="icon">⚠️</span>
      <h4 class="title">Требуется подтверждение оператора</h4>
    </div>
    <div class="confirmation-body">
      <p class="description">
        <strong>Действие:</strong> {{ data.action_description }}
      </p>
      <div v-if="data.potential_risks && data.potential_risks.length" class="risks">
        <strong>Потенциальные риски:</strong>
        <ul>
          <li v-for="(risk, index) in data.potential_risks" :key="index">{{ risk }}</li>
        </ul>
      </div>
    </div>
    <div class="confirmation-buttons">
      <button class="btn confirm" @click="sendResponse('confirm, you can proceed')">
        ✅ Разрешить
      </button>
      <button class="btn deny" @click="sendResponse('deny, cancel this action and choose another one')">
        ❌ Отклонить
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { useChatStore } from '@/shared/stores';

interface Props {
  data: {
    action_description: string;
    potential_risks?: string[];
  };
}
defineProps<Props>();

const chatStore = useChatStore();

const sendResponse = (response: string) => {
  if (!chatStore.currentSession?.agentId) return;
  chatStore.continueChatConversation(chatStore.currentSession.agentId, response);
};
</script>

<style scoped lang="scss">
.confirmation-request {
  border: 2px solid #f59e0b;
  border-radius: 12px;
  background-color: #fffbeb;
  padding: 16px;
  margin: 12px 0;
}
.confirmation-header {
  display: flex;
  align-items: center;
  gap: 12px;
  border-bottom: 1px solid #fef3c7;
  padding-bottom: 12px;
  margin-bottom: 12px;
}
.icon {
  font-size: 24px;
}
.title {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: #92400e;
}
.description {
  margin: 0 0 12px 0;
  color: #b45309;
}
.risks {
  font-size: 14px;
  color: #92400e;
  ul {
    margin: 4px 0 0 0;
    padding-left: 20px;
  }
}
.confirmation-buttons {
  display: flex;
  gap: 12px;
  margin-top: 16px;
}
.btn {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  &.confirm {
    background-color: #10b981;
    color: white;
    &:hover { background-color: #059669; }
  }
  &.deny {
    background-color: #ef4444;
    color: white;
    &:hover { background-color: #dc2626; }
  }
}
</style>